<!-- Enjoy, It is free ;) -->

<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Map - Sattelite</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; }
  #map { width: 100%; height: 100%; }

  /* Zwevende zoekbalk */
  #searchBox {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    width: 320px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: width 0.2s ease;
  }
  #searchInput {
    width: 100%;
    padding: 10px 12px;
    border: none;
    outline: none;
    font-size: 14px;
    box-sizing: border-box;
  }

  /* Suggesties */
  #suggestions {
    display: none;
    flex-direction: column;
    max-height: 200px;
    overflow-y: auto;
    background: white;
  }
  #suggestions div {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 14px;
  }
  #suggestions div:hover { background: #f0f0f0; }

  /* Scrollbalk suggesties */
  #suggestions::-webkit-scrollbar { width: 6px; }
  #suggestions::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }

  /* Info box onderaan */
  #info {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: rgba(255,255,255,0.95);
    padding: 8px 12px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    font-size: 14px;
  }
</style>
</head>
<body>

<div id="searchBox">
  <input type="text" id="searchInput" placeholder="Zoek locatie...">
  <div id="suggestions"></div>
</div>

<div id="map"></div>
<div id="info">Even wachten op GPS...</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map', { attributionControl: false }).setView([0,0],2);
  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { maxZoom: 19 }).addTo(map);

  const info = document.getElementById('info');
  let marker;

  // Browser GPS live volgen
  if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition(
      (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const accuracy = pos.coords.accuracy;

        info.textContent = `Latitude: ${lat.toFixed(6)}, Longitude: ${lng.toFixed(6)} (Â±${Math.round(accuracy)} m)`;

        if(!marker){
          marker = L.marker([lat,lng]).addTo(map).bindPopup("Je bent hier!").openPopup();
          map.setView([lat,lng],18);
        } else {
          marker.setLatLng([lat,lng]);
        }
      },
      (err) => { info.textContent = "GPS kon niet worden opgehaald: " + err.message; },
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  } else {
    info.textContent = "GPS niet beschikbaar in deze browser.";
  }

  // Zoekfunctie met debounce
  const input = document.getElementById('searchInput');
  const suggestionsBox = document.getElementById('suggestions');
  let timeoutId;

  input.addEventListener('input', () => {
    clearTimeout(timeoutId);
    const query = input.value.trim();
    if(!query){ suggestionsBox.style.display='none'; return; }

    timeoutId = setTimeout(() => {
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
        .then(r => r.json())
        .then(data => {
          suggestionsBox.innerHTML = '';
          if(data.length===0){ suggestionsBox.style.display='none'; return; }

          data.slice(0,5).forEach(item => {
            const div = document.createElement('div');
            div.textContent = item.display_name;
            div.addEventListener('click', () => {
              const latlng = [parseFloat(item.lat), parseFloat(item.lon)];
              map.setView(latlng,15);
              L.marker(latlng).addTo(map).bindPopup(item.display_name).openPopup();
              suggestionsBox.style.display='none';
              input.value='';
            });
            suggestionsBox.appendChild(div);
          });
          suggestionsBox.style.display='flex';
        });
    }, 300);
  });

  input.addEventListener('keypress', e => {
    if(e.key==='Enter'){
      const first = suggestionsBox.querySelector('div');
      if(first) first.click();
      e.preventDefault();
    }
  });

  document.addEventListener('click', e => {
    if(!document.getElementById('searchBox').contains(e.target))
      suggestionsBox.style.display='none';
  });
</script>

</body>
</html>
